// -- Sammy.js -- plugins/sammy.oauth2.js
// http://sammyjs.org
// Version: 0.7.0
// Built: 2011-08-08T12:31:53+0200
(function(a){Sammy=Sammy||{},Sammy.OAuth2=function(b){function c(a){var b=a.match(/#(.*)$/)[1],c=b.split("&"),d={};for(var e in c){var f=c[e].split("=");d[f[0]]=f[1].replace(/\+/g," ")}return d}b.use("JSON"),this.authorize="/oauth/authorize",this.helper("requireOAuth",function(a){if(this.app.getAccessToken())a&&a.apply(this);else{this.redirect(this.app.authorize+"?state="+escape(this.path));return!1}}),this.helper("loseAccessToken",function(){this.app.loseAccessToken()}),this.requireOAuth=function(a){this.before(a||{},function(a){return a.requireOAuth()})},this.getAccessToken=function(){return this.session("oauth.token")},this.setAccessToken=function(a){this.session("oauth.token",a),this.trigger("oauth.connected")},this.loseAccessToken=function(){this.session("oauth.token",null),this.trigger("oauth.disconnected")},a(document).ajaxSend(function(a,c){var d=b.getAccessToken();d&&c.setRequestHeader("Authorization","OAuth "+d)});var d;this.bind("run",function(a,b){d=b.start_url||"#",this.app.getAccessToken()&&this.trigger("oauth.connected")}),this.before(/#(access_token=|[^\\].*\&access_token=)/,function(a){var b=c(a.path);this.app.setAccessToken(b.access_token),a.redirect(b.state.length===0?this.app.start_url:unescape(b.state));return!1}).get(/#(access_token=|[^\\].*\&access_token=)/,function(a){}),this.before(/#(error=|[^\\].*\&error=)/,function(a){var b=c(a.path),d=b.error_description||"Access denined";a.trigger("oauth.denied",{code:b.error,message:d});return!1}).get(/#(error=|[^\\].*\&error=)/,function(a){})}})(jQuery)